% Copyright (c) 2014
% Written by Gabriel Hjort Blindell <ghb@kth.se>

\documentclass[11pt,twocolumn,twoside]{memoir}

%============
% PAPER SIZE
%============

% TODO: make text height higher
\setstocksize{846bp}{648bp}
\settrimmedsize{10.75in}{8in}{*}
\settrims{36bp}{36bp}
\settypeblocksize{600bp}{480bp}{*}
\setcolsepandrule{18bp}{0pt}
\setulmargins{111bp}{*}{*}
\setlrmargins{36bp}{*}{*}
\setheaderspaces{*}{20bp}{*}
\setheadfoot{18bp}{21bp}
\setmarginnotes{1bp}{1bp}{1bp}
\checkandfixthelayout



%==========
% PACKAGES
%==========

\usepackage{libertine} % Sans-serif font
\usepackage{garamondx} % Serif font
\usepackage[scaled=.75]{beramono} % Typewriter font
\usepackage{microtype}
\usepackage{anyfontsize}
\usepackage{url}
\usepackage{enumitem}



%========
% MACROS
%========

% Predefine metadata commands (to be redefined by input file)
\newcommand{\thisArchiveName}{}
\newcommand{\thisAssistantEditor}{}
\newcommand{\thisDocBuild}{}
\newcommand{\thisDocUrl}{}
\newcommand{\thisEditor}{}
\newcommand{\thisFullVersion}{}
\newcommand{\thisLastModified}{}
\newcommand{\thisNewsgroups}{}
\newcommand{\thisSubject}{}
\newcommand{\thisTitle}{}
\newcommand{\thisSubtitle}{}

\newcommand{\makeTitlePage}{%
  \onecolumn
  \thispagestyle{empty}
  \begingroup
    \centering%
    \mbox{}
    \vfill
    {\fontsize{50}{60}\selectfont\textsc{\thisTitle}}

    \vspace*{36pt}

    {\Huge Version \thisSubtitle}
    \vfill
    \mbox{}
    \vfill
    \mbox{}
    \vfill
  \endgroup%
  \pagebreak%
  \twocolumn%
}

\newcommand{\makeCopyrightPage}{%
  \onecolumn%
  \thispagestyle{empty}
  \begingroup
    \setlength{\parindent}{0pt}
    \mbox{}
    \vfill

    Collected and edited by: \thisEditor\\
    Assistant editor: \thisAssistantEditor\\
    Newsgroups: \thisNewsgroups\\
    Subject: \thisSubject\\
    Full version: \thisFullVersion\\
    Archive name: \texttt{\thisArchiveName}\\
    Last modified: \thisLastModified

    \vspace{\baselineskip}

    Document URL: \thisDocUrl\\
    Document build: \texttt{\thisDocBuild}

    \vspace{\baselineskip}

    Typeset by Gabriel Hjort Blindell \typesetUrl{ghb@kth.se} using \LaTeX{}.\\
    Fonts: \emph{Garamond} (basefont, 11pt), \emph{Linux Libertine}
    (sans-serif), and \emph{Bera Mono} (monotype).
  \endgroup%
  \pagebreak%
  \twocolumn%
}

\newcommand{\makeTOCPage}{%
  \twocoltocetc
  \tableofcontents
}

\newcommand{\typesetUrl}[1]{\url{<#1>}}
\newcommand{\typesetUsenet}[1]{\url{#1}}

\newlength{\indentWidth}
\setlength{\indentWidth}{\parindent}
\newlength{\indentContWidth}
\setlength{\indentContWidth}{2\parindent}

% Don't separate items in any lists
\setlist{noitemsep}

% Define list environment for indenting regular text
\newlist{indentText}{description}{1}
\setlist[indentText]{%
  leftmargin=\indentContWidth,
  labelindent=\indentWidth,
  labelsep=0pt,
  labelwidth=0pt,
  itemsep=0pt,
}

% Define list environment for excerpt texts
\newlist{excerptText}{description}{1}
\setlist[excerptText]{%
  leftmargin=\indentContWidth,
  labelindent=\indentWidth,
  labelsep=0pt,
  labelwidth=0pt,
  before=\itshape,
}

% Commands for typesetting quotes from the Pratchett books
\newcommand{\apQuote}[3]{%
  \vspace{\baselineskip}

  \noindent
  \mbox{\texttt{#1~#2}} #3

  \vspace{\baselineskip}
}

% Removes chapter and section numbering
\setsecnumdepth{book}
\maxsecnumdepth{book}

% Change typesetting of chapters
% TODO: implement

% Change typesetting of sections
\newcommand*{\typesetSection}[1]{%
  \noindent\rule{\linewidth}{0.4pt}

  \huge\scshape\centering #1

  \vspace*{-0.8ex}
  \noindent\rule{\linewidth}{0.4pt}\par
}
\setsecheadstyle{\typesetSection}

% Customize header and footer
\renewcommand{\tocmark}{\markboth{\MakeUppercase{\contentsname}}{}}
\renewcommand{\chaptermark}[1]{\markboth{\MakeUppercase{#1}}{}}
\renewcommand{\sectionmark}[1]{\markright{\MakeUppercase{#1}}}
\makeevenhead{headings}{\thepage}{}{\leftmark}
\makeoddhead{headings}{\rightmark}{}{\thepage}

% Remove leading dots from ToC
\renewcommand{\cftdot}{}

% Change typesetting of items in ToC
\renewcommand{\cftchapterfont}{\bfseries\scshape}
\renewcommand{\cftsectionfont}{\scshape}

% Add vertical column rule
\setlength{\columnseprule}{0.4pt}



%==========
% DOCUMENT
%==========

\begin{document}
\input{\inputFile}
\end{document}
